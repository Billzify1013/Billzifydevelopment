{% load static %}
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="{% static 'undercss/assets/'%}"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>BILLZIFY</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'undercss/assets/img/favicon/1.PNG'%}" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/fonts/boxicons.css'%}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/css/core.css'%}" class="template-customizer-core-css'%}" />
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/css/theme-default.css'%}" class="template-customizer-theme-css'%}" />
    <link rel="stylesheet" href="{% static 'undercss/assets/css/demo.css'%}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css'%}" />

    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/libs/apex-charts/apex-charts.css'%}" />

    {% comment %} <link rel="stylesheet" href="{% static 'undercss/assets/vendor/libs/spinkit/spinkit.css'%}" /> {% endcomment %}

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="{% static 'undercss/assets/vendor/js/helpers.js'%}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'undercss/assets/js/config.js'%}"></script>
  </head>

  <style>
    #dd1::-webkit-scrollbar {
      width: 2px;
    }
   #dd1::-webkit-scrollbar-track {
      background-color: none;
    }
    #dd1::-webkit-scrollbar-thumb {
      background-color:#696cff;
      border-radius:10px;
    }
  </style>

  <body>

<div class="content-wrapper">
    <!--header start-->
        <div class="container-xxl flex-grow-1 container-p-y">

            <div class="col-xl m-25">
                <div class="card mb-4">
                  <div class="card-header d-flex align-items-center justify-content-between">
                    <h5 class="mb-0">Room no : <span class="text-success">{{id}}</span></h5>
                    <input type=button value="Back" class="btn btn-outline-warning" onClick="javascript:history.go(-1);">
                    
                  </div></div></div>

    <!--header start-->

<div class="row">


<div class="content-wrapper">
  <!--header start-->
      <div class="container-xxl flex-grow-1 container-p-y">
        <div class="row">
<div class="col-xl-12">

  <div class="nav-align-top mb-4">
    <ul class="nav nav-pills mb-3 nav-fill" role="tablist">
      <li class="nav-item">
        <button
          type="button"
          class="nav-link active"
          role="tab"
          onclick="adddayscalculation()"
          data-bs-toggle="tab"
          data-bs-target="#navs-pills-justified-home"
          aria-controls="navs-pills-justified-home"
          aria-selected="true"
        ><i class="tf-icons bx bx-user"></i>
          Personal Information of Guest
        </button>
      </li>
      <li class="nav-item">
        <button
          type="button"
          class="nav-link"
           onclick="adddayscalculation()"
          role="tab"
          data-bs-toggle="tab"
          data-bs-target="#navs-pills-justified-profile"
          aria-controls="navs-pills-justified-profile"
          aria-selected="false"
        >
         
          <i class='bx bxl-paypal mb-1'></i>&nbsp;&nbsp;&nbsp;Payment Details & Billing</button>
      </li>
     
    </ul>
    <div class="tab-content">
      <div class="tab-pane fade show active" id="navs-pills-justified-home" role="tabpanel">
        <!--guest information-->
        <div class="card-body">
          <h5 class="mb-5 mt-0">Personal Information of Guest</h5>
        <form action="{% url 'addguestdata'  %}" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="hidden" name="staydays" id="resultdaysinput" />
          <div class="row">
              <div class="col-6">
                  <div class="mb-3">
                      <div class="input-group input-group-merge">
                        <span id="basic-icon-default-fullname2" class="input-group-text"
                          ><i class="bx bx-user"></i
                        ></span>
                        <input
                          type="text"
                          name = "guestname"
                          class="form-control"
                          id="basic-icon-default-fullname"
                          placeholder="John Doe"
                          aria-label="John Doe"
                          aria-describedby="basic-icon-default-fullname2"
                        />
                      </div>
                    </div>
              </div>
              <div class="col-6">
                  <div class="mb-3">
                      <div class="input-group input-group-merge">
                        <span id="basic-icon-default-company2" class="input-group-text"
                          ><i class="bx bx-phone"></i
                              ></span>
                        <input
                          type="tel"  pattern="[6-9][0-9]{9}"
                          name = "guestphone"
                          id="basic-icon-default-company"
                          class="form-control"
                          placeholder="Phone"
                          required
                          aria-label="ACME Inc."
                          aria-describedby="basic-icon-default-company2"
                        />
                      </div>
                    </div>
              </div>
          </div>


          <div class="row">
              <div class="col-3">
                  <div class="mb-3 mt-3">
                      <div class="input-group input-group-merge">
                        <span class="input-group-text"><i class="bx bx-envelope"></i></span>
                        <input
                          type="email"
                          name = "guestemail"
                          id="basic-icon-default-email"
                          class="form-control"
                          placeholder="john.doe"
                          aria-label="john.doe"
                          aria-describedby="basic-icon-default-email2"
                        />
                        <span id="basic-icon-default-email2" class="input-group-text">@example.com</span>
                      </div>
                    </div>
              </div>

              <div class="mb-3 col-md-3 mt-3">
                
                <select id="country" name="STATE" required placeholder="select States" class="select2 form-select">
                  <option value="">Select States</option>
                  <optgroup label="Indian States">
                  <option value="andhra_pradesh">Andhra Pradesh</option>
                  <option value="arunachal_pradesh">Arunachal Pradesh</option>
                  <option value="assam">Assam</option>
                  <option value="bihar">Bihar</option>
                  <option value="chhattisgarh">Chhattisgarh</option>
                  <option value="goa">Goa</option>
                  <option value="gujarat">Gujarat</option>
                  <option value="haryana">Haryana</option>
                  <option value="himachal_pradesh">Himachal Pradesh</option>
                  <option value="jharkhand">Jharkhand</option>
                  <option value="karnataka">Karnataka</option>
                  <option value="kerala">Kerala</option>
                  <option value="madhya_pradesh">Madhya Pradesh</option>
                  <option value="maharashtra">Maharashtra</option>
                  <option value="manipur">Manipur</option>
                  <option value="meghalaya">Meghalaya</option>
                  <option value="mizoram">Mizoram</option>
                  <option value="nagaland">Nagaland</option>
                  <option value="odisha">Odisha</option>
                  <option value="punjab">Punjab</option>
                  <option value="rajasthan">Rajasthan</option>
                  <option value="sikkim">Sikkim</option>
                  <option value="tamil_nadu">Tamil Nadu</option>
                  <option value="telangana">Telangana</option>
                  <option value="tripura">Tripura</option>
                  <option value="uttar_pradesh">Uttar Pradesh</option>
                  <option value="uttarakhand">Uttarakhand</option>
                  <option value="west_bengal">West Bengal</option>
              </optgroup>
              <optgroup label="Union Territories">
                  <option value="andaman_and_nicobar_islands">Andaman and Nicobar Islands</option>
                  <option value="chandigarh">Chandigarh</option>
                  <option value="dadra_and_nagar_haveli_and_daman_and_diu">Dadra and Nagar Haveli and Daman and Diu</option>
                  <option value="lakshadweep">Lakshadweep</option>
                  <option value="delhi">Delhi</option>
                  <option value="puducherry">Puducherry</option>
                  <option value="ladakh">Ladakh</option>
                  <option value="jammu_and_kashmir">Jammu and Kashmir</option>
              </optgroup>
              <optgroup label="Other Locations">
                  <option value="foreign">Foreign</option>
              </optgroup>
            </select>
  
              </div>



              
              <div class="col-3">
                  <div class="mb-3 mt-3">
                      <div class="input-group input-group-merge">
                        <span id="basic-icon-default-company2" class="input-group-text"
                          ><i class='bx bxs-edit-location'></i></span>
                        <input
                          type="text"
                          name = "guestcity"
                          id="basic-icon-default-company"
                          class="form-control"
                          placeholder="City."
                          aria-label="ACME Inc."
                          aria-describedby="basic-icon-default-company2"
                        />
                      </div>
                    </div>
              </div>

              <div class="col-3">
                  <div class="mb-3 mt-3">
                      <div class="input-group input-group-merge">
                        <span id="basic-icon-default-company2" class="input-group-text"
                          ><i class='bx bxs-edit-location'></i></span>
                        <input
                          type="text"
                          name = "guestcountry"
                          id="basic-icon-default-company"
                          class="form-control"
                          placeholder="Country"
                          aria-label="ACME Inc."
                          aria-describedby="basic-icon-default-company2"
                        />
                      </div>
                    </div>
              </div>
          </div>

          <div class="row">
            <script>
              document.addEventListener('DOMContentLoaded', () => {
                // Check if element exists in the DOM
                const guestCheckinDateInput = document.getElementById('checkindate');
                if (!guestCheckinDateInput) {
                    console.error("Element with ID 'guestcheckindate' not found in the DOM.");
                    return;
                }
                
                // Get today's date
                const today = new Date();
                const year = today.getFullYear();
                const month = ('0' + (today.getMonth() + 1)).slice(-2); // Adding leading zero if needed
                const day = ('0' + today.getDate()).slice(-2); // Adding leading zero if needed
                const formattedDate = `${year}-${month}-${day}`;
                
                // Set the value of the date input to today's date
                guestCheckinDateInput.value = formattedDate;
                
                console.log(`Set guest check-in date to: ${formattedDate}`);
            });
          </script>
              <div class="col-6">
                  <div class="mb-3">
                      <div class="input-group input-group-merge">
                        <span id="basic-icon-default-company2" class="input-group-text"
                          >Check-IN</span>
                        <input
                          type="date"
                          readonly
                          name = "guestcheckindate"
                          id="checkindate"
                          class="form-control"
                          
                        />
                      </div>
                    </div>
              </div>
              <script>
                document.addEventListener("DOMContentLoaded", function() {
                    const dateInput = document.getElementById("checkoutdate");
                    const today = new Date().toISOString().split("T")[0]; // Get today's date in YYYY-MM-DD format
                    dateInput.setAttribute("min", today); // Set minimum date to today
                });
            </script>
              <div class="col-6">
                  <div class="mb-3">
                      <div class="input-group input-group-merge" >
                        <span id="basic-icon-default-company2" class="input-group-text"
                          >Check-OUT</span>
                        <input
                          type="date"
                          trigger: 'focus'
                          name = "guestcheckoutdate"
                          id="checkoutdate"
                          class="form-control"
                          placeholder="Phone"
                          aria-label="ACME Inc."
                          
                          aria-describedby="basic-icon-default-company2"
                          required
                        />
                      </div>
                    </div>
                    
              </div>
          </div>

          <div class="row">
          <div class="col-3">
              <div class="mb-3 mt-3">
                  <div class="input-group input-group-merge">
                    <span id="basic-icon-default-company2" class="input-group-text"
                      ><i class='bx bx-time-five' ></i></span>
                    
                    <select class="form-control" placeholder="Chek-In Time">
                      <option>T+1 Day</option>
                      <option>3hour</option>
                      <option>6hour</option>
                      <option>9hour</option>
                    </select>
                  </div>
                </div>
          </div>

          <div class="col-3">
              <div class="mb-3 mt-3">
                  <div class="input-group input-group-merge">
                    <span id="basic-icon-default-company2" class="input-group-text"
                      ><i class='bx bxs-group'></i></span>
                    <input
                      type="number"
                      required
                      name = "noofguest"
                      id="basic-icon-default-company"
                      class="form-control"
                      placeholder="Number of Guests"
                      aria-label="ACME Inc."
                      aria-describedby="basic-icon-default-company2"
                    />
                  </div>
                </div>
          </div>
          <div class="col-3">
              <div class="mb-3 mt-3">
                  <div class="input-group input-group-merge">
                    <span id="basic-icon-default-company2" class="input-group-text"
                      ><i class='bx bxs-user'></i></span>
                    <input
                      type="number" 
                      required
                      name = "guestadults"
                      id="basic-icon-default-company"
                      class="form-control"
                      placeholder="Adults"
                      aria-label="ACME Inc."
                      aria-describedby="basic-icon-default-company2"
                    />
                  </div>
                </div>
          </div>

          <div class="col-3">
              <div class="mb-3 mt-3">
                  <div class="input-group input-group-merge">
                    <span id="basic-icon-default-company2" class="input-group-text"
                      ><i class='bx bx-child'></i></span>
                    <input
                      type="number"
                      required
                      name = "guestchildren"
                      id="basic-icon-default-company"
                      class="form-control"
                      placeholder="Children"
                      aria-label="ACME Inc."
                      aria-describedby="basic-icon-default-company2"
                    />
                  </div>
                </div>
          </div>
      
      </div>

      <div class="row">
          <div class="col-6">
              <div class="mb-3">
                  <div class="input-group input-group-merge">
                    <span id="basic-icon-default-company2" class="input-group-text"
                      >Id-Front</span>
                      <input
                    type="file"
                    name = "guestid"
                    class="form-control"
                    id="inputGroupFile04"
                    aria-describedby="inputGroupFileAddon04"
                    aria-label="Upload"
                  />
                  <button class="btn btn-outline-primary" type="button" id="inputGroupFileAddon04">Button</button>
                  </div>
                </div>
          </div>
          <div class="col-6">
              <div class="mb-3">
                <div class="input-group input-group-merge">
                  <span id="basic-icon-default-company2" class="input-group-text"
                    ><i class='bx bx-child'></i></span>
                  <input
                    type="text"
                    name = "Purpose"
                    id="basic-icon-default-company"
                    class="form-control"
                    placeholder="Purpose of Visit"
                    aria-label="ACME Inc."
                    aria-describedby="basic-icon-default-company2"
                  />
                </div>
                </div>
                {% comment %} <button type="button" class="btn btn-primary float-end" onclick="adddayscalculation()">Save Information & Continue</button> {% endcomment %}
          </div>

      </div>
              
          
        
      </div> 

      <!--guest information end-->

      </div>
      <div class="tab-pane fade" id="navs-pills-justified-profile" role="tabpanel">
        

        <!--payment information start-->
        <div class="card-body">
          {%for i in room_data%}
          <input type="hidden" value="{{i.room_name}} " name="roomno"/>
          <div class="row">
            
            <!-- Basic -->
            <div class="col-md-12 mb-4">
              <div class="card">
                
                <div class="row " >
                  <h5 class="mb-1 mt-3 ms-4"><i class="tf-icons bx bx-message-square"></i>  Room Information </h5>
                  <div class="col-4">
                    
                    <h5 class="card-header mb-1">Room No: <span class="text-success fw-bold">{{i.room_name}} </span>
                      <br><br>Total Stay Day : <span class="text-success fw-bold" id="resultdays"></span>
                    </h5>
                  </div>

                  <div class="col-4">

                    <h5 class="card-header mb-1">Room Price: <span class="text-success fw-bold">{{i.price}} </span>
                      <br><br>Category : <span class="text-success fw-bold" >{{i.room_type}}</span>
                      <input type="hidden" id="roomprice" value="{{i.price}}" />
                      <input type="hidden" id="roomtax" value="{{i.tax.taxrate}}" />
                      
                    </h5>
                  </div>

                  <div class="col-4">

                    <h5 class="card-header mb-1">Room Tax: <span class="text-success fw-bold">{{i.tax}} </span>
                      <br><br>Total amount incl tax and days: <span class="text-success fw-bold" id="totalamounttext"></span>
                    </h5>
                  </div>

                </div>


                <div class="row " >
                  <!--payment form-->
                  
                  <h5 class="mb-1 mt-3 ms-4"><i class='bx bxl-paypal mb-1'></i>Payment Details </h5>
                  
                  <div class="row mt-4" >
                    <div class="col-3 ms-4 ">
                    
                    <div class="input-group">
                      <span class="input-group-text" id="basic-addon11">Subtotal ₹</span>
                      <input
                        type="number"
                        name = "subtotal"
                        id="subtotal"
                        class="form-control"
                        placeholder="Username"
                        value="{{i.price}}"
                        aria-label="Username"
                        aria-describedby="basic-addon11"
                      />
                      <input type="hidden" value="{{i.price}}" id="subtotalinput" />
                    </div>
                  </div>

                  <div class="col-4">

                    
                  
                    <div class="input-group">
                      
                      <select id="selectopt" class="form-control">
                        <option value="Fixed" class="form-control">Fixed </option>
                      </select>
                      
                      <input
                        type="text"
                        value="0"
                        name="discount"
                        id="discountamount"
                        class="form-control"
                        aria-label="Text input with segmented dropdown button"
                      /><button type="button" class="btn btn-primary" onclick="adddiscount()">Add Discount</button>
                    </div>
                  
                  </div>

                  <div class="col-3">
                    <div class="input-group">
                      <span class="input-group-text" id="basic-addon11">Total ₹</span>
                      <input
                        type="number"
                        name="total"
                        class="form-control"
                        placeholder="TOTAL AMOUNT"
                        id="totalamount"
                        value="{{i.price}}"
                        aria-label="Username"
                        aria-describedby="basic-addon11"
                      />
                    </div>
                  </div>
                  <input type="hidden" name="tax" value="{{i.tax}} "/>
                  

                </div><div class="row " >
              
              </div>

              <div class="row ms-3" >
                <p class="demo-inline-spacing ">
                  <a
                    class="btn btn-primary me-1"
                    data-bs-toggle="collapse"
                    href="#multiCollapseExample2"
                    role="button"
                    aria-expanded="false"
                    aria-controls="multiCollapseExample2"
                    >Add More Guest</a
                  >
                  
                </p>

                <div class="col-12 col-md-6  mb-md-0">
                  <div class="collapse multi-collapse" id="multiCollapseExample2">
                      <div class="input-group">
                        <div class="row">
                          <div class="col mb-3">
                            <label for="nameBackdrop" class="form-label">Guest Name</label>
                            <input
                              type="text"
                              name="moreguestname"
                              id="nameBackdrop"
                              class="form-control"
                              placeholder="Enter Name"
                            />
                          </div>

                          <div class="col mb-3">
                            <label for="nameBackdrop" class="form-label">Guest Phone</label>
                            <input
                              type="number"
                              name="moreguestphone"
                              id="nameBackdrop"
                              class="form-control"
                              placeholder="Enter Phone"
                            />
                          </div>

                          <div class="col mb-3">
                            <label for="nameBackdrop" class="form-label">Guest Address</label>
                            <input
                              type="text"
                              name="moreguestaddress"
                              id="nameBackdrop"
                              class="form-control"
                              placeholder="Enter Address"
                            />
                          </div>

                        </div>
                        
                          
                        <input class="form-check-input ms-2"  type="checkbox"  name="checkmoredatastatus"/>&nbsp;&nbsp;&nbsp;
                          <p>If You Want To Save Data So Please Active The CheckBox.</p>
                        </div>
                  </div>
                  <div class="row">
                  <div class="col mb-3 w-50">
                    <label for="nameBackdrop" class="form-label">Payment</label>
                    <select class="form-control" name="paidstatus" id="selectValuepaid" onchange="showpaymentstatus()" placeholder="Select Payment" required>
                      <option  value="Unpaid">Unpaid</option>  
                      <option  value="Paid">Paid</option>
                        
                    </select>
                  </div>

                  <div class="col mb-3 w-50" style="display:none" id="selectcashdiv">
                    <label for="nameBackdrop" class="form-label">Payment Mode</label>
                    <select class="form-control" name="paymentstatus"  id="selectValue" onchange="showinput()" placeholder="Select Payment" required>
                        <option  value="cash">Cash</option>
                        <option  value="online">Online</option>
                        <option  value="Partly">Partially</option>
                    </select>
                  </div>
                  <div class="col w-100 " id="inputcash" style="display:none">
                    <label for="nameBackdrop" class="form-label">Cash Amount</label>
                    <input type="number" class="form-control" name="cashamount" id="inputcash" placeholder="Cash Amount" />
                    
                </div>
                  <div class="col  w-100"  id="inputonline" style="display:none">
                    <label for="nameBackdrop" class="form-label">Online Payment </label>
                    <input type="number" class="form-control" name="onlineamount" id="inputonline" placeholder="Online Amount" />
                  </div>
                </div>
              </div>
                  
              
            </div>

            <script>
              function showpaymentstatus() {
                var selectValuepaid = document.getElementById('selectValuepaid').value;
                if (selectValuepaid == "Paid"){
                  document.getElementById('selectcashdiv').style.display="block";
                  }
                  if (selectValuepaid == "Unpaid"){
                    document.getElementById('selectcashdiv').style.display="none";
                    document.getElementById('inputcash').style.display="none";
                  document.getElementById('inputonline').style.display="none";
                    }
              }


              function showinput() {
                  var selectElement = document.getElementById('selectValue');
                  var selectedValue = selectElement.value;
                  document.getElementById('inputcash').style.display="none";
                  document.getElementById('inputonline').style.display="none";
                  if (selectedValue == "Partly"){
                  document.getElementById('inputcash').style.display="block";
                  document.getElementById('inputonline').style.display="block";
                  document.getElementById('nameBackdrop').style.display="block";
                  }
              };
            </script>
            
           

              <div class="row">

                <div class="col-3">
                  <button type="submit" class="btn btn-primary mt-4 mb-4 ms-4 w-100" > Booking Done</button>
                </div>
                
                
               

              </div>
            </form>
              
            </div>{%endfor%}

            

            <!--js of discount button-->

            <script type="text/javascript">

    

              {% comment %} adddayscalculation {% endcomment %}
              function adddayscalculation(){
                
                var startDateStr = $("#checkindate").val();
    var endDateStr = $("#checkoutdate").val();
    
    // Convert the input values to Date objects
    var startDate = new Date(startDateStr);
    var endDate = new Date(endDateStr);
    
    // Calculate the difference in milliseconds
    var timeDiff = endDate.getTime() - startDate.getTime();
    
    // Convert milliseconds to days
    var daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
               

                
                console.log(daysDiff)
                // Display the result
                $("#resultdays").text( daysDiff);
                daysDiff= parseFloat(daysDiff)
                $("#resultdaysinput").val( daysDiff);
                var subtotalamountbyinput = document.getElementById('subtotalinput').value
                var roomprice = $("#roomprice").val();
                roomprice = parseInt(roomprice)
                subtotalamount = subtotalamountbyinput * daysDiff
                var roomtax = $("#roomtax").val();
                var taxamount = (roomprice * roomtax) /100
                var totalamount = (taxamount + roomprice) * daysDiff
                $("#totalamountdays").text(totalamount);
                document.getElementById('totalamount').value = totalamount;
                document.getElementById('subtotal').value = subtotalamount;
                document.getElementById('totalamounttext').innerHTML = totalamount;
              }

              function adddiscount() {
                var subtotal = document.getElementById('subtotalinput').value
                var selectopt = document.getElementById('selectopt').value;
                var diffdays = document.getElementById('resultdays').innerHTML;
                var roomtax = $("#roomtax").val();
                if (selectopt == 'Fixed') {
                  var discountamount = document.getElementById('discountamount').value;
                  
                }
                else{
                  var discountamount = document.getElementById('discountamount').value;
                  discountamount = (subtotal * discountamount /100) 
                
                  
                }
                document.getElementById('totalamount').value = total;
              
                subtotal = subtotal * diffdays
                subtotal = subtotal - discountamount

                var total = subtotal 
                var taxamount = (total * roomtax) /100
                total = taxamount + total
               
                
                document.getElementById('totalamount').value = total;
                document.getElementById('subtotal').value = subtotal;
                document.getElementById('totalamounttext').innerHTML = total;
              }
            </script>
            <!--js of discount button end-->
            

       
  </div> 
      
      <!--Payment information end-->


      </div>
     
      </div>
    </div>
  </div>
</div>
</div>
{%if loyltydata%}
<!--loylty data here-->
<div class="row    mt-4" style="height:450px">
  <div class="col-4 m-4 card">
    
    <label for="nameBackdrop" class="form-label ms-5 mt-5 ">Guest Phone Number To Check Loyalty Data</label>
    <div class="input-group input-group-merge w-75 mt-2 ms-5">
      <span id="basic-icon-default-company2" class="input-group-text"
        ><i class="bx bx-phone"></i
            ></span>
      <input
        type="number"
        name = "guestphone"
        id="phoneguest"
        class="form-control "
        placeholder="Phone"
        aria-label="ACME Inc."
        aria-describedby="basic-icon-default-company2"
      />
    </div>
    
    <button id="btnsavedate" class="btn btn-primary w-75 mt-4 ms-5">Check Loyalty Data</button>
    <p class="text m-2 mt-5">
      Please wait while it displays the loyalty data. If the information is incorrect, refresh the page and try again.</p>
    <p class="text text-danger m-2">After adding loyalty data, please avoid refreshing the page or going back. Make sure all fields are filled before adding loyalty data, as it will be applied to discounts automatically and removed from loyalty records.
    </p>
  </div>
  <div class="col-7 m-1 card">
    
     <!-- List group Icons -->
     <div class="col-lg-12">
      <div class="demo-inline-spacing mt-3">
        <ul class="list-group">
          <li class="list-group-item d-flex align-items-center">
            <i class='bx bx-street-view'></i>
            Guest Name  <span class="badge ms-5 w-25 bg-label-primary me-1" id="name"></span>
          </li>
          <li class="list-group-item d-flex align-items-center">
            <i class="bx bx-phone me-2"></i
              >
            Guest Contact  <span class="badge ms-4 me-1 w-25 bg-label-primary me-1" id="contact"></span>
          </li>
          
          <li class="list-group-item d-flex align-items-center">
            <i class="bx bx-purchase-tag-alt me-2"></i>
            Loyalty Points In ₹ 
            <span class="badge w-25 ms-2 bg-label-primary me-1" id="lyltyamount"></span>
            <span class="badge w-25 ms-2 bg-label-danger me-1" id="lyltyamountdelete"></span>
          </li>
          
          <!-- Error Display -->
          <div class="text-danger" id="errorshowajax"></div>
          <div class="row">
            <span>
            <i class='bx bxs-cube-alt m-2'></i><b>Add Discount</b> :Add automatically Loyalty Amount  Data To Discount</span>
            <span><i class='bx bxs-cube-alt m-2'></i>
              <b>Data Redeem:</b>If you want to use these loyalty points, click the "Add Discount" button and check Loyalty Ponits Added to Discount Amount and Applied on amount, After that click "Redeem" button to remove the loyalty data from the guest's contact. After that, submit the customer form.
            </span>
          <button class="btn btn-primary m-3 w-25" onClick="adddiscount()">Add Discount </button>
          <button class="btn btn-success m-3 w-25" id="Deleteloyltydata">Points Redeem</button>
          </div>
        </ul>
      </div>
    </div>
    <!--/ List group Icons -->


  </div>
  <!--end here-->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    $("#btnsavedate").click(function(){
        let phoneno = $("#phoneguest").val();
        console.log(phoneno);
  
        // Clear previous data and error messages
        $("#name").empty();
        $("#contact").empty();
        $("#loyltypoint").empty();
        $("#lyltyamount").empty();
        $("#loyltyid").val('');
        $('#errorshowajax').empty();
        $('#lyltyamountdelete').empty();
        $.ajax ({
          type: "POST",
          url: "/getloyltydataajax",
          data: {
              Mobile: phoneno,
          },
          success: function (data) {
            if (data.error) {
                $('#errorshowajax').html('<p>Error: ' + data.error + '</p>');
            } else {
                var name, id, contact, loyltypoints;
                // Assuming data is an array of objects
                data.forEach(function(item) {
                  name = item.guest_name; // Assign guest_name to name variable
                  id = item.id; // Assign id to id variable
                  contact = item.guest_contact; // Assign guest_contact to contact variable
                  loyltypoints = item.loylty_point; // Assign loylty_point to loyltypoints variable
                });
                
                console.log(name);
                $("#name").html(name);
                $("#contact").html(contact);
                $("#loyltypoint").html(loyltypoints);
                $("#lyltyamount").html(loyltypoints);
                $("#loyltyid").val(id);
                $("#discountamount").val(loyltypoints);
            }
          },
          error: function(xhr, status, error) {
            $('#errorshowajax').html('<p>Error: ' + xhr.statusText + '</p>');
          }
        });
    });



    //delete loylty data 
    $("#Deleteloyltydata").click(function(){
      let phoneno = $("#phoneguest").val();
      console.log(phoneno);

      // Clear previous data and error messages
      $("#name").empty();
      $("#contact").empty();
      $("#loyltypoint").empty();
      $("#lyltyamount").empty();
      $("#loyltyid").val('');
      $('#errorshowajax').empty();
      console.log("worked")
      $.ajax ({
        type: "POST",
        url: "/deleteloyltyajaxdata",
        data: {
            Mobile: phoneno,
        },
        success: function (data) {
          if (data.error) {
              $('#errorshowajax').html('<p>Error: ' + data.error + '</p>');
          } else {
              var name, id, contact, loyltypoints;
              // Assuming data is an array of objects
              data.forEach(function(item) {
                name = item.guest_name; // Assign guest_name to name variable
                id = item.id; // Assign id to id variable
                contact = item.guest_contact; // Assign guest_contact to contact variable
                loyltypoints = item.loylty_point; // Assign loylty_point to loyltypoints variable
              });
              
              console.log(name);
              $("#name").html(name);
              $("#contact").html(contact);
              $("#loyltypoint").html(loyltypoints);
              $("#lyltyamountdelete").html(loyltypoints);
              $("#discountamount").val(loyltypoints);
          }
        },
        error: function(xhr, status, error) {
          $('#errorshowajax').html('<p>Error: ' + xhr.statusText + '</p>');
        }
      });
  });
  </script>
  
  {%endif%}





</div>
</div>
</div>
</div>









 








               <!-- build:js assets/vendor/js/core.js -->
               <script src="{% static 'undercss/assets/vendor/libs/jquery/jquery.js'%}"></script>
               <script src="{% static 'undercss/assets/vendor/libs/popper/popper.js'%}"></script>
               <script src="{% static 'undercss/assets/vendor/js/bootstrap.js'%}"></script>
               <script src="{% static 'undercss/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js'%}"></script>
           
               <script src="{% static 'undercss/assets/vendor/js/menu.js'%}"></script>
               <!-- endbuild -->
           
               <!-- Vendors JS -->
               <script src="{% static 'undercss/assets/vendor/libs/apex-charts/apexcharts.js'%}"></script>
           
               <!-- Main JS -->
               <script src="{% static 'undercss/assets/js/main.js'%}"></script>
           
               <!-- Page JS -->
               <script src="{% static 'undercss/assets/js/dashboards-analytics.js'%}"></script>
           
               <!-- Place this tag in your head or just before your close body tag. -->
               <script async defer src="https://buttons.github.io/buttons.js"></script>
             </body>
           </html>
           
           



           <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Elegant Light Lavender Loader</title>
                <style>
                    body {
                        margin: 0;
                        font-family: Arial, sans-serif;
                        background-color: #f3f3f3;
                    }
            
                    .loader-wrapper {
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent background */
                        z-index: 9998;
                    }
            
                    .loader {
                        position: relative;
                        width: 60px;
                        height: 60px;
                    }
            
                    .loader div {
                        position: absolute;
                        border: 4px solid transparent;
                        border-top-color: #c5a3ff; /* Light lavender color */
                        border-radius: 50%;
                        animation: spin 1.5s ease infinite;
                    }
            
                    .loader div:nth-child(1) {
                        width: 60px;
                        height: 60px;
                        animation-delay: -0.45s;
                    }
            
                    .loader div:nth-child(2) {
                        width: 45px;
                        height: 45px;
                        top: 7.5px;
                        left: 7.5px;
                        animation-delay: -0.3s;
                    }
            
                    .loader div:nth-child(3) {
                        width: 30px;
                        height: 30px;
                        top: 15px;
                        left: 15px;
                        animation-delay: -0.15s;
                    }
            
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
            
                    #content {
                        display: none; /* Hide content initially */
                        opacity: 0;
                        transition: opacity 0.5s ease;
                    }
            
                    .loader-wrapper.hidden #content {
                        display: block;
                        opacity: 1;
                    }
                </style>
            </head>
            <body>
                <div id="loader-wrapper" class="loader-wrapper">
                    <div class="loader">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
                <div id="content">
                   
                </div>
            
                <script>
                    // Show the loader when the page is loading
                    document.addEventListener('DOMContentLoaded', function() {
                        document.getElementById('loader-wrapper').style.display = 'flex';
                        document.getElementById('content').style.display = 'none'; // Hide the content
                    });
            
                    // Hide the loader and show the content when the page has fully loaded
                    window.addEventListener('load', function() {
                        document.getElementById('loader-wrapper').style.display = 'none'; // Hide the loader
                        document.getElementById('content').style.display = 'block'; // Show the content
                        setTimeout(function() {
                            document.getElementById('content').style.opacity = '1'; // Fade in the content
                        }, 50); // Slight delay for the fade effect
                    });
                </script>
            </body>
            
            <script type="text/javascript">
              // Disable right-click
              document.addEventListener('contextmenu', function(e) {
                  e.preventDefault();
              });
            
              // Disable common inspect shortcuts
              document.addEventListener('keydown', function(e) {
                  if (e.keyCode == 123) { // F12 key
                      e.preventDefault();
                  }
                  if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) { // Ctrl+Shift+I
                      e.preventDefault();
                  }
                  if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) { // Ctrl+Shift+J
                      e.preventDefault();
                  }
                  if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) { // Ctrl+U
                      e.preventDefault();
                  }
              });
            </script>
            </html>
            